FROM python:3.11-slim

# Install uv
COPY --from=ghcr.io/astral-sh/uv:0.3.4 /uv /bin/uv

# Copy the application into the container.
COPY . /app

# Copy the entrypoint into the container.
COPY ./compose/production/fastapi/entrypoint /entrypoint
RUN sed -i 's/\r$//g' /entrypoint
RUN chmod +x /entrypoint

# Install the application dependencies.
WORKDIR /app
RUN uv sync --frozen --no-cache --no-install-project

EXPOSE 8000

CMD ["/entrypoint"]